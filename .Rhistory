roofflat:sheltered,
rf_formula = gr ~ ground_max
+  winter_wind_all  +
temp_avg +  sheltered +
exposed + Parapet + Heated
+ Insulated + roofflat + slope_1_15)
wa_ta_results
nrow(na.omit(gr_vars2))
step_all_build <- lm(sqrtgr ~ logground +
roofflat + logsize + sheltered + exposed + Insulated +
Parapet + roofflat*sheltered, na.omit(gr_vars2))
step_int_bulid <- lm(sqrtgr ~ 1, na.omit(gr_vars2))
step_forward_build <- step(step_int_build, direction='both',
scope=formula(step_all_build), trace=1)
step_all_build <- lm(sqrtgr ~ logground +
roofflat + logsize + sheltered + exposed + Insulated +
Parapet + roofflat*sheltered, na.omit(gr_vars2))
step_int_build <- lm(sqrtgr ~ 1, na.omit(gr_vars2))
step_forward_build <- step(step_int_build, direction='both',
scope=formula(step_all_build), trace=1)
step_backward_build <- step(step_all_build, direction='both',
scope=formula(step_all_build), trace=1)
summary(step_forward2)
step_all_build <- lm(sqrtgr ~ logground +
roofflat + logsize + sheltered + exposed + Insulated +
Parapet + roofflat*sheltered, na.omit(gr_vars2))
step_int_build <- lm(sqrtgr ~ 1, na.omit(gr_vars2))
step_forward_build <- step(step_int_build, direction='both',
scope=formula(step_all_build), trace=1)
step_backward_build <- step(step_all_build, direction='both',
scope=formula(step_all_build), trace=1)
summary(step_forward_build)
summary(step_backward_build)
################################ building only model ###########################
mod6 <- lm(sqrtgr ~ logground +  sheltered +
exposed  +  Parapet + Heated +logsize
+ Insulated + roofflat + slope_1_15
roofflat:sheltered ,gr_total)
################################ building only model ###########################
mod6 <- lm(sqrtgr ~ logground +  sheltered +
exposed  +  Parapet + Heated +logsize
+ Insulated + roofflat + slope_1_15 +
roofflat:sheltered,gr_total)
summary(mod6)
set.seed(1234)
build_results <- cross_valid_acc(data = sqrtgr ~ logground +  sheltered +
exposed  +  Parapet + Heated +logsize
+ Insulated + roofflat + slope_1_15 +
roofflat:sheltered
rf_formula = gr ~ ground_max +  sheltered +
set.seed(1234)
build_results1 <- cross_valid_acc(data = sqrtgr ~ logground +  sheltered +
exposed  +  Parapet + Heated +logsize
+ Insulated + roofflat + slope_1_15 +
roofflat:sheltered,
rf_formula = gr ~ ground_max +  sheltered +
exposed  +  Parapet + Heated +logsize
+ Insulated + roofflat + slope_1_15)
set.seed(1234)
build_results1 <- cross_valid_acc(data = gr_total,
fromula2 = sqrtgr ~ logground +  sheltered +
exposed  +  Parapet + Heated +logsize
+ Insulated + roofflat + slope_1_15 +
roofflat:sheltered,
rf_formula = gr ~ ground_max +  sheltered +
exposed  +  Parapet + Heated +logsize
+ Insulated + roofflat + slope_1_15)
set.seed(1234)
build_results1 <- cross_valid_acc(data = gr_total,
formula2 = sqrtgr ~ logground +  sheltered +
exposed  +  Parapet + Heated +logsize
+ Insulated + roofflat + slope_1_15 +
roofflat:sheltered,
rf_formula = gr ~ ground_max +  sheltered +
exposed  +  Parapet + Heated +logsize
+ Insulated + roofflat + slope_1_15)
build_results1
set.seed(1234)
build_results2 <- cross_valid_acc(data = gr_total,
formula2 = sqrtgr ~ logground +  sheltered +
exposed  +  Parapet + Heated
+ Insulated + roofflat + slope_1_15 +
roofflat:sheltered,
rf_formula = gr ~ ground_max +  sheltered +
exposed  +  Parapet + Heated
+ Insulated + roofflat + slope_1_15)
build_results2
################################ building only model ###########################
mod6 <- lm(sqrtgr ~ logground +  sheltered +
exposed  +  Parapet + Heated
+ Insulated + roofflat + slope_1_15 +
roofflat:sheltered, gr_total)
summary(mod6)
################################ building only model ###########################
mod6 <- lm(sqrtgr ~ logground +  sheltered +
exposed  +  Parapet + Heated +logsize
+ Insulated + roofflat + slope_1_15 +
roofflat:sheltered, gr_total)
summary(mod6)
################################ building only model ###########################
mod6 <- lm(sqrtgr ~ logground +  sheltered +
exposed  +  Parapet + Heated
+ Insulated + roofflat + slope_1_15 +
roofflat:sheltered, gr_total)
summary(mod6)
build_results1
build_results2
w2_ta_results
wa_ta_results
w2_af_results
wa_af_results
wa_af_results <- cross_valid_acc(data = gr_total, formula2 = sqrtgr ~ logground
+  wind_avg  +
above_freeze_all +  sheltered +
exposed + Parapet + Heated
+ Insulated + roofflat + slope_1_15 +
roofflat:winter_wind_all +
roofflat:sheltered,
rf_formula = gr ~ ground_max
+  wind_avg  +
above_freeze_all +  sheltered +
exposed + Parapet + Heated
+ Insulated + roofflat + slope_1_15)
set.seed(1234)
wa_af_results <- cross_valid_acc(data = gr_total, formula2 = sqrtgr ~ logground
+  wind_avg  +
above_freeze_all +  sheltered +
exposed + Parapet + Heated
+ Insulated + roofflat + slope_1_15 +
roofflat:winter_wind_all +
roofflat:sheltered,
rf_formula = gr ~ ground_max
+  wind_avg  +
above_freeze_all +  sheltered +
exposed + Parapet + Heated
+ Insulated + roofflat + slope_1_15)
wa_af_results
build_results2
set.seed(1234)
weather <- cross_valid_acc(data = gr_total, formula2 = sqrtgr ~ logground +
winter_wind_all  + temp_avg +
above_freeze_all ,
rf_formula = gr ~ ground_max +
winter_wind_all  + temp_avg +
above_freeze_all)
w2_ta_results
View(wa_ta_results)
weather
set.seed(1234)
w2_ta_weather <- cross_valid_acc(data = gr_total, formula2 = sqrtgr ~ logground +
winter_wind_all  + temp_avg  ,
rf_formula = gr ~ ground_max +
winter_wind_all  + temp_avg)
w2_ta_weather
set.seed(1234)
w2_af_weather <- cross_valid_acc(data = gr_total, formula2 = sqrtgr ~ logground +
wind_avg  + above_freeze_all  ,
rf_formula = gr ~ ground_max +
wind_avg  + above _freeze_all)
set.seed(1234)
w2_af_weather <- cross_valid_acc(data = gr_total, formula2 = sqrtgr ~ logground +
wind_avg  + above_freeze_all ,
rf_formula = gr ~ ground_max +
wind_avg  + above_freeze_all)
wa_af_weather
set.seed(1234)
wa_af_weather <- cross_valid_acc(data = gr_total, formula2 = sqrtgr ~ logground +
wind_avg  + above_freeze_all ,
rf_formula = gr ~ ground_max +
wind_avg  + above_freeze_all)
wa_af_weather
wa_af_weather
w2_ta_weather
wa_af_weather
w2_af_weather <- cross_valid_acc(data = gr_total, formula2 = sqrtgr ~ logground +
winter_wind_all  + above_freeze_all ,
rf_formula = gr ~ ground_max +
winter_wind_all  + above_freeze_all)
w2_af_weather
w2_ta_weather
weather
set.seed(1234)
wa_ta_weather <- cross_valid_acc(data = gr_total, formula2 = sqrtgr ~ logground +
wind_avg  + temp_avg ,
rf_formula = gr ~ ground_max +
wind_avg  + temp_avg)
wa_ta_weather
build_results2
set.seed(1234)
set.seed(1234)
ERA5_both <- cross_valid_acc(data = gr_total, formula2 = sqrtgr ~ logground
+  est_wind  +
temp_avg +  sheltered +
exposed + Parapet + Heated
+ Insulated + roofflat + slope_1_15 +
roofflat:winter_wind_all +
roofflat:sheltered,
rf_formula = gr ~ ground_max
+  est_wind  +
temp_avg +  sheltered +
exposed + Parapet + Heated
+ Insulated + roofflat + slope_1_15)
ERA5_both
set.seed(1234)
set.seed(1234)
ERA5_both <- cross_valid_acc(data = gr_total, formula2 = sqrtgr ~ logground
+  est_wind  +
temp_avg +  sheltered +
exposed + Parapet + Heated
+ Insulated + roofflat + slope_1_15 +
roofflat:est_wind +
roofflat:sheltered,
rf_formula = gr ~ ground_max
+  est_wind  +
temp_avg +  sheltered +
exposed + Parapet + Heated
+ Insulated + roofflat + slope_1_15)
ERA5_both
set.seed(1234)
ERA5_both <- cross_valid_acc(data = gr_total, formula2 = sqrtgr ~ logground
+  est_wind  +
est_temp_avg +  sheltered +
exposed + Parapet + Heated
+ Insulated + roofflat + slope_1_15 +
roofflat:est_wind +
roofflat:sheltered,
rf_formula = gr ~ ground_max
+  est_wind  +
est_temp_avg +  sheltered +
exposed + Parapet + Heated
+ Insulated + roofflat + slope_1_15)
ERA5_both
ERA5_ta <- cross_valid_acc(data = gr_total, formula2 = sqrtgr ~ logground
+   est_temp_avg +  sheltered +
exposed + Parapet + Heated
+ Insulated + roofflat + slope_1_15 +
roofflat:sheltered,
rf_formula = gr ~ ground_max
+
est:temp_avg +  sheltered +
exposed + Parapet + Heated
+ Insulated + roofflat + slope_1_15)
set.seed(1234)
ERA5_ta <- cross_valid_acc(data = gr_total, formula2 = sqrtgr ~ logground
+   est_temp_avg +  sheltered +
exposed + Parapet + Heated
+ Insulated + roofflat + slope_1_15 +
roofflat:sheltered,
rf_formula = gr ~ ground_max
+ est_temp_avg +  sheltered +
exposed + Parapet + Heated
+ Insulated + roofflat + slope_1_15)
ERA5_both
ERA5_ta
model1 <- lm(sqrtgr ~ logground, gr_total)
summary_model1
summary(model1)
ERA_both <- lm(sqrtgr ~ logground
+  est_wind  + est_temp_avg +  sheltered + exposed + Parapet +
Heated + Insulated + roofflat + slope_1_15 +
roofflat:est_wind + roofflat:sheltered,
data = gr_total)
summary(ERA_both)
ERA_temp <- lm(sqrtgr ~ logground
+ est_temp_avg +  sheltered + exposed + Parapet +
Heated + Insulated + roofflat + slope_1_15 +
roofflat:sheltered,
data = gr_total)
summary(ERA_temp)
building_mod <- lm(sqrtgr ~ logground +  sheltered +
exposed  +  Parapet + Heated
+ Insulated + roofflat + slope_1_15 +
roofflat:sheltered,
data = gr_total)
summary(building_mod)
devtools::load_all()
gr_total <- read.csv("data-raw//updated_data.csv")
gr_total$logsize <- log(gr_total$Size)
set.seed(1234)
ERA5_wa <- cross_valid_acc(data = gr_total, formula2 = sqrtgr ~ logground
+  est_wind_avg  +
est_temp_avg +  sheltered +
exposed + Parapet + Heated
+ Insulated + roofflat +
roofflat:est_wind_avg +
roofflat:sheltered,
rf_formula = gr ~ ground_max
+  est_wind_avg  +
est_temp_avg +  sheltered +
exposed + Parapet + Heated
+ Insulated + roofflat )
ERA5_wa
set.seed(1234)
ERA5_w2 <- cross_valid_acc(data = gr_total, formula2 = sqrtgr ~ logground
+  est_wind  +
est_temp_avg +  sheltered +
exposed + Parapet + Heated
+ Insulated + roofflat +
roofflat:est_wind +
roofflat:sheltered,
rf_formula = gr ~ ground_max
+  est_wind  +
est_temp_avg +  sheltered +
exposed + Parapet + Heated
+ Insulated + roofflat )
ERA5_w_2
ERA5_w2
ERA5_wa
## Modeling work
library(glmnet)
library(GGally)
library(ggplot2)
library(rpart)
library(rpart.plot)
library(car)
library(cowplot)
# version 1 of data
#gr_total <- read.csv("data-raw//wind_all.csv")
# version 2 of data
gr_total <- read.csv("data-raw//updated_data.csv")
model1 <- lm(sqrtgr ~ logground, gr_total)
## obtaining resids from original model
gr_total$resid <- residuals(model1)
resid_data <- gr_total |> dplyr::select(wind_avg, temp_avg, Slope,
roofflat, Size, exposed, sheltered, Heated,
Insulated, Parapet, winter_wind_all,
above_freeze_all, slope15, resid)
resid_no_na <- na.omit(resid_data)
### Creating tree to look for interactions
tree <- rpart(formula = resid ~ ., data = resid_no_na)
prp(tree)
pruned_tree <- prune(tree, cp = 0.04)
prp(pruned_tree)
## Setting up
resid_all <- lm(resid ~ . + roofflat*winter_wind_all + roofflat*wind_avg +
roofflat*sheltered + slope15*winter_wind_all +
slope15*wind_avg + slope15*sheltered,
resid_no_na)
resid_int <- lm(resid ~ 1, resid_no_na)
## Running forward and backward regression
resid_forward <- step(resid_int, direction='both', scope=formula(resid_all),
trace=1)
resid_backward <- step(resid_all, direction='both', scope=formula(resid_all),
trace=1)
summary(resid_forward)
summary(resid_backward)
## Running Lasso regression here
## Adding interaction columns to resid_no_na
resid_no_na$w2rf <- resid_no_na$winter_wind_all * resid_no_na$roofflat
resid_no_na$warf <- resid_no_na$wind_avg * resid_no_na$roofflat
resid_no_na$shrf <- resid_no_na$sheltered * resid_no_na$roofflat
colnames(resid_no_na)
y <- resid_no_na$resid
x <- data.matrix(resid_no_na[, c(1:12,15:17)])
cv_model <- cv.glmnet(x, y, alpha = 1)
best_lambda <- cv_model$lambda.min
best_lambda
best_model <- glmnet(x, y, alpha = 1, lambda = best_lambda)
coef(best_model)
cv_model2 <- cv.glmnet(x, y, alpha = 0.5)
best_lambda2 <- cv_model2$lambda.min
best_lambda2
best_model2 <- glmnet(x, y, alpha = 0.5, lambda = best_lambda2)
coef(best_model2)
### Now try step regression with original thing
gr_vars <- gr_total |> dplyr::select(sqrtgr, logground, roofflat, sheltered,
winter_wind_all, exposed, temp_avg,
above_freeze_all, Size, Parapet, Heated
, Insulated)
## Setting up
step_all <- lm(sqrtgr ~ logground + roofflat + sheltered + winter_wind_all +
exposed + temp_avg + above_freeze_all + Size + Parapet + Heated
+ Insulated + roofflat:winter_wind_all +
roofflat:sheltered, na.omit(gr_vars))
step_int <- lm(sqrtgr ~ 1, na.omit(gr_vars))
## Running forward and backward regression
step_forward <- step(step_int, direction='both', scope=formula(step_all),
trace=1)
step_backward <- step(step_all, direction='both', scope=formula(step_all),
trace=1)
summary(step_forward)
summary(step_backward)
## Running model based on selector methods
model_new <- lm(sqrtgr ~ logground +  winter_wind_all  + temp_avg +
above_freeze_all +  sheltered +
exposed  + Size + Parapet + Heated
+ Insulated + roofflat + roofflat:winter_wind_all +
roofflat:sheltered,gr_total)
summary(model_new)
og_mod <- lm(sqrtgr ~ logground, data = gr_total)
summary(og_mod)
gr_total$logsize <- log(gr_total$Size)
############## all this to attempt to plot side by side  ####################
df <- structure(list(var1 = 1:5,var2 = 4:8, var3 = 6:10),
.Names = c("var1",  "var2", "var3"),
row.names = c(NA, -5L), class = "data.frame")
non_weather_cont <- ggpairs(gr_total |> dplyr::select(sqrtgr,
logground, logsize)) + theme_bw() +
theme(axis.text.y = element_blank(),
axis.text.x = element_blank(),
axis.ticks = element_blank())
weather_cont <- ggpairs(gr_total |> dplyr::select(sqrtgr, winter_wind_all, temp_avg,
above_freeze_all)) + theme_bw() +
theme(axis.text.y = element_blank(),
axis.text.x = element_blank(),
axis.ticks = element_blank())
cowplot::plot_grid(
GGally::ggmatrix_gtable(non_weather_cont),
GGally::ggmatrix_gtable(weather_cont),
nrow = 2,
rel_heights = c(4,6))
##################################### logging size ############################
gr_vars2 <- gr_total |> dplyr::select(sqrtgr, logground, roofflat, sheltered,
winter_wind_all,
exposed, temp_avg, above_freeze_all,logsize,
Parapet, Heated, Insulated, slope_1_15)
## Setting up
step_all2 <- lm(sqrtgr ~ logground + roofflat + sheltered + winter_wind_all +
exposed + temp_avg + above_freeze_all + logsize + Parapet + Heated
+ Insulated + roofflat:winter_wind_all +
roofflat:sheltered, na.omit(gr_vars2))
step_int2 <- lm(sqrtgr ~ 1, na.omit(gr_vars2))
## Running forward and backward regression
step_forward2 <- step(step_int2, direction='both', scope=formula(step_all2),
trace=1)
step_backward2 <- step(step_all2, direction='both', scope=formula(step_all2),
trace=1)
summary(step_forward2)
summary(step_backward2)
######################## Residual and QQ plot ################################
mod1 <- lm(sqrtgr ~ logground +  winter_wind_all  + temp_avg +
above_freeze_all +  sheltered +
exposed  +  Parapet + Heated
+ Insulated + roofflat + roofflat:winter_wind_all +
roofflat:sheltered, gr_total)
summary(mod1)
resid_gg <- ggplot(mod1, aes(x = .fitted, y = .resid)) +
geom_point() +
geom_hline(yintercept = 0) +
labs(x = "Fitted Values", y= "Residuals") +
theme_bw() +
theme(axis.text = element_text(size = 12, face = "bold"),
axis.title = element_text(size = 14, face = "bold"))
residuals <- resid(mod1)
qq_data <- qqplot(qnorm(ppoints(length(residuals))), residuals)
# Convert the output of qqplot to a data frame
qq_data_df <- data.frame(Theoretical = qq_data$x, Residuals = qq_data$y)
# Plot the QQ plot using ggplot2
qq_gg <- ggplot(qq_data_df, aes(x = Theoretical, y = Residuals)) +
geom_point() +
geom_abline(intercept = mean(residuals), slope = sd(residuals)) +
labs(x = "Theoretical Quantiles", y = "Residuals") +
theme_bw() +
theme(axis.text = element_text(size = 12, face = "bold"),
axis.title = element_text(size = 14, face = "bold"))
gridExtra::grid.arrange(resid_gg, qq_gg, ncol = 2)
shapiro.test(mod1$residuals)
## Trying with winter_wind_all and above_freeze
mod2 <- lm(sqrtgr ~ logground +  winter_wind_all  +
above_freeze_all +  sheltered +
exposed   + Parapet + Heated
+ Insulated + roofflat + roofflat:winter_wind_all +
roofflat:sheltered ,gr_total)
summary(mod2)
## winter_wind_all and temp_avg
mod3 <- lm(sqrtgr ~ logground +  winter_wind_all  +
temp_avg +  sheltered +
exposed + Parapet + Heated
+ Insulated + roofflat  + roofflat:winter_wind_all +
roofflat:sheltered, gr_total)
summary(mod3)
## wind_avg and above_freeze
mod4 <- lm(sqrtgr ~ logground +  wind_avg  +
above_freeze +  sheltered +
exposed + Parapet + Heated
+ Insulated + roofflat  + roofflat:winter_wind_all +
roofflat:sheltered ,gr_total)
summary(mod4)
## wind_avg and temp_avg
mod5 <- lm(sqrtgr ~ logground +  wind_avg  +
temp_avg +  sheltered +
exposed  +  Parapet + Heated
+ Insulated + roofflat + roofflat:winter_wind_all +
roofflat:sheltered ,gr_total)
summary(mod5)
par(mfrow = c(1,3))
plot(gr_total$sqrtgr, gr_total$winter_wind_all, xlab= "sqrtgr", ylab = "W2",
main = "W2 and sqrt GR plot")
qqnorm(resid(mod2))
qqline(mod2$residuals)
plot(mod2$fitted.values, mod2$residuals, xlab = "Fitted values",
ylab = "Residuals", main = "W2 redsidual plot")
abline(0,0)
################################ building only model ###########################
mod6 <- lm(sqrtgr ~ logground +  sheltered +
exposed  +  Parapet + Heated
+ Insulated + roofflat +
roofflat:sheltered, gr_total)
summary(mod6)
pairs(na.omit(gr_vars))
cor(na.omit(gr_vars))
colnames(gr_total)
View(gr_total[,55:56])
ERA_both <- lm(sqrtgr ~ logground
+  est_wind  +
est_temp_avg +  sheltered +
exposed + Parapet + Heated
+ Insulated + roofflat +
roofflat:est_wind +
roofflat:sheltered,
data = gr_total)
summary(ERA_both)
